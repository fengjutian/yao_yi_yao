# 店铺管理页面功能说明

## ✅ 已完成的功能

### 1. 查询功能
- ✅ 页面加载时自动查询所有店铺
- ✅ 按创建时间倒序排列（最新的在前）
- ✅ 只显示当前用户的店铺（通过 openid 过滤）

### 2. 新增功能
- ✅ 输入店铺名称（必填）
- ✅ 输入店铺地址（可选）
- ✅ 选择店铺分类（必填）：中餐、日料、快餐、西餐
- ✅ 上传店铺照片（可选）
- ✅ 保存时自动设置权重为 1（摇一摇时使用）

### 3. 编辑功能
- ✅ 点击"编辑"按钮，店铺信息回填到表单
- ✅ 表单按钮显示为"更新店铺"
- ✅ 可以修改所有字段（名称、地址、分类、照片）
- ✅ 支持取消编辑，清空表单

### 4. 删除功能
- ✅ 点击"删除"按钮，弹出确认对话框
- ✅ 确认后删除店铺
- ✅ 如果正在编辑被删除的店铺，自动清空表单

### 5. 照片功能
- ✅ 支持从相册或相机选择照片
- ✅ 照片上传到云存储（restaurant_photos 目录）
- ✅ 照片显示在列表中（点击可预览大图）
- ✅ 支持重新上传照片

### 6. 数据字段
- ✅ `name` - 店铺名称（必填）
- ✅ `address` - 店铺地址（可选）
- ✅ `category` - 店铺分类（必填）
- ✅ `photoUrl` - 店铺照片 URL（可选）
- ✅ `weight` - 权重（新增时设为 1，编辑不修改）
- ✅ `createdAt` - 创建时间
- ✅ `updatedAt` - 更新时间（编辑时更新）

## 🎨 界面特点

### 表单区域
- 卡片式设计，美观大方
- 清晰的标签和输入框
- 照片上传区域，支持点击预览
- 双按钮设计：添加/更新 + 取消编辑

### 列表区域
- 每个店铺显示为卡片
- 左侧显示照片（如果有）
- 右侧显示店铺信息
- 底部显示操作按钮（编辑、删除）
- 空状态提示：暂无店铺

### 交互体验
- 加载提示：添加、更新、删除都有 Loading
- 成功提示：操作成功显示 Toast
- 错误提示：操作失败显示错误信息
- 确认删除：防止误删

## 📱 使用方法

### 添加新店铺
1. 输入店铺名称（必填）
2. 输入店铺地址（可选）
3. 选择分类（必填）
4. 点击照片区域上传照片（可选）
5. 点击"添加店铺"按钮

### 编辑店铺
1. 点击列表中的"编辑"按钮
2. 修改需要更新的字段
3. 可以重新上传照片
4. 点击"更新店铺"按钮保存

### 删除店铺
1. 点击列表中的"删除"按钮
2. 在确认对话框中点击"确定"
3. 店铺被删除

### 预览照片
- 点击列表中的照片或表单中的照片
- 全屏预览大图

## 🔒 数据安全

- ✅ 只显示当前用户的店铺（通过 openid 隔离）
- ✅ 删除前二次确认
- ✅ 编辑时显示"更新"而非"添加"，避免混淆
- ✅ 照片上传到云存储，自动生成唯一文件名

## 📊 数据库结构

```javascript
{
  _id: "xxx", // 自动生成
  userId: "xxx", // 用户 openid
  name: "店铺名称",
  address: "店铺地址",
  category: "分类",
  photoUrl: "cloud://xxx", // 云存储文件 ID
  weight: 1, // 权重
  createdAt: 1234567890,
  updatedAt: 1234567890 // 编辑时更新
}
```

## 🚀 与摇一摇功能的联动

- 添加的店铺自动出现在摇一摇列表中
- 编辑店铺信息会更新摇一摇中的显示
- 删除店铺会从摇一摇中移除
- 权重影响摇一摇的推荐概率

## 🎯 未来可扩展功能

- [ ] 批量删除
- [ ] 搜索店铺
- [ ] 按分类筛选
- [ ] 多张照片支持
- [ ] 营业时间字段
- [ ] 联系电话字段
- [ ] 评分功能
- [ ] 评论功能
